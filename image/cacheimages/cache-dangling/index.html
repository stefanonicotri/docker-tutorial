
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Cache dangling - Docker Tutorial</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Docker Tutorial" class="md-header__button md-logo" aria-label="Docker Tutorial" data-md-component="logo">
      
  <img src="../../../assets/logo_infn.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docker Tutorial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cache dangling
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Docker Tutorial" class="md-nav__button md-logo" aria-label="Docker Tutorial" data-md-component="logo">
      
  <img src="../../../assets/logo_infn.png" alt="logo">

    </a>
    Docker Tutorial
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Persistent data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Persistent data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data/volumes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker volumes and bind-mounts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data/volume_plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker volume plugins - an example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../data/volume_summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Container networking
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Container networking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bridge mode and port mapping
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Cache dangling</h1>

<p>Let's do a quick check on our docker system: </p>
<div class="highlight"><pre><span></span><code>docker images

REPOSITORY                    TAG       IMAGE ID       CREATED         SIZE
test                          latest    259e2e6b1ac1   7 minutes ago   101MB
&lt;none&gt;                        &lt;none&gt;    589c6427b137   7 minutes ago   101MB
ubuntu                        18.04     81bcf752ac3d   3 weeks ago     63.1MB
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago     1.09GB
</code></pre></div>
<p>we should wonder what are the images with a <code>&lt;none&gt;</code> tag, you can see when you list all the images present on your system</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Spolinig: these are dagnling images</p>
</div>
<p>One thing more: </p>
<div class="highlight"><pre><span></span><code>docker images -a 

REPOSITORY                    TAG       IMAGE ID       CREATED         SIZE
test                          latest    259e2e6b1ac1   7 minutes ago   101MB
&lt;none&gt;                        &lt;none&gt;    589c6427b137   7 minutes ago   101MB
&lt;none&gt;                        &lt;none&gt;    e63fa5024b8d   7 minutes ago   101MB
&lt;none&gt;                        &lt;none&gt;    24a0ae7fb9f2   7 minutes ago   101MB
&lt;none&gt;                        &lt;none&gt;    333abd901bf3   7 minutes ago   99.7MB
ubuntu                        18.04     81bcf752ac3d   3 weeks ago     63.1MB
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago     1.09GB
</code></pre></div>
<p>again: why there are these images with a <code>&lt;none&gt;</code> tag, you can see when you list all the images present on your system</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Spolinig: these are intermediate cached images</p>
</div>
<p>Let's clean-up all our docker environment and use our previusly developed Dockerfile to package the application</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>system<span class="w"> </span>prune
</code></pre></div>
<ul>
<li>Be carefull! this wil clean-up a lot: <ul>
<li>all stopped containers</li>
<li>all networks not used by at least one container</li>
<li>all dangling images</li>
<li>all dangling build cache</li>
</ul>
</li>
</ul>
<p>there are other way to select what to remove see here [REF]</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li><code>docker rmi $(docker images -a --filter=dangling=true -q)</code></li>
<li><code>docker rm $(docker ps --filter=status=exited --filter=status=created -q)</code></li>
</ul>
</div>
<p>once we have cleaned our system we will get something like the following: </p>
<pre><code> 
<b>$ docker images</b>
REPOSITORY                    TAG       IMAGE ID       CREATED       SIZE
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago   1.09GB
ubuntu                        latest    7e0aa2d69a15   7 weeks ago   72.7MB


<b>$ docker images  -a</b>
REPOSITORY                    TAG       IMAGE ID       CREATED       SIZE
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago   1.09GB
ubuntu                        latest    7e0aa2d69a15   7 weeks ago   72.7MB
tutor5@tutorvm-5:~/myimage$ 
</code></pre>

<p>this is time now to build our application. So let's start again with our Dockerfile:</p>
<div class="highlight"><pre><span></span><code>FROM ubuntu:18.04
RUN apt-get update
RUN apt-get install -y figlet
ENTRYPOINT [&quot;figlet&quot;, &quot;-f&quot;, &quot;script&quot;]
CMD [&quot;pippo&quot;]
</code></pre></div>
<p>Now we can build it and we will get something like this: </p>
<pre><code>
<b>docker build -t testnone .</b>

Sending build context to Docker daemon  2.048kB
Step 1/5 : FROM ubuntu:18.04
18.04: Pulling from library/ubuntu
4bbfd2c87b75: Pull complete 
d2e110be24e1: Pull complete 
889a7173dcfe: Pull complete 
Digest: sha256:67b730ece0d34429b455c08124ffd444f021b81e06fa2d9cd0adaf0d0b875182
Status: Downloaded newer image for ubuntu:18.04
 ---> <b>81bcf752ac3d</b>
Step 2/5 : RUN apt-get update
 ---> Running in 80bb3a4b5a8c
... ( remove output ) 
Reading package lists...
Removing intermediate container 80bb3a4b5a8c
 ---> e095319ffe18
Step 3/5 : RUN apt-get install figlet
 ---> Running in 30b20940a069
.... ( remove output ) 
Removing intermediate container 30b20940a069
 ---> 9ad1cce70073
Step 4/5 : ENTRYPOINT ["figlet", "-f", "script"]
 ---> Running in 911a64ae9765
Removing intermediate container 911a64ae9765
 ---> cca054892aec
Step 5/5 : CMD ["pippo"]
 ---> Running in 67d507ed70c0
Removing intermediate container 67d507ed70c0
 ---> f0684153d22f
Successfully built <b>f0684153d22f</b>
Successfully tagged testnone:latest
</code></pre>

<p>and let's check again our system: </p>
<pre><code>
tutor5@tutorvm-5:~/myimage$ docker images
REPOSITORY                    TAG       IMAGE ID       CREATED              SIZE
testnone                      latest    <b>f0684153d22f</b>   About a minute ago   101MB
ubuntu                        18.04     <b>81bcf752ac3d</b>   3 weeks ago          63.1MB
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago          1.09GB
ubuntu                        latest    7e0aa2d69a15   7 weeks ago          72.7MB
</code></pre>

<p>alright but then if I check further: </p>
<pre><code>
tutor5@tutorvm-5:~/myimage$ docker images -a 
REPOSITORY                    TAG       IMAGE ID       CREATED              SIZE
testnone                      latest    f0684153d22f   About a minute ago   101MB
&ltnone&gt                        &ltnone&gt    <b>cca054892aec</b>   About a minute ago   101MB
&ltnone&gt                        &ltnone&gt    <b>9ad1cce70073</b>   About a minute ago   101MB
&ltnone&gt                        &ltnone&gt    <b>e095319ffe18</b>   2 minutes ago        99.7MB
ubuntu                        18.04     81bcf752ac3d   3 weeks ago          63.1MB
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago          1.09GB
ubuntu                        latest    7e0aa2d69a15   7 weeks ago          72.7MB
</code></pre>

<p>where those come from ? 
Those are the intermediate images genereated while building our image:</p>
<pre><code>
Removing intermediate container 80bb3a4b5a8c
 ---> <b>e095319ffe18</b>
Step 3/5 : RUN apt-get install figlet
 ---> Running in 30b20940a069
.... ( remove output )
Removing intermediate container 30b20940a069
 ---> <b>9ad1cce70073</b>
Step 4/5 : ENTRYPOINT ["figlet", "-f", "script"]
 ---> Running in 911a64ae9765
Removing intermediate container 911a64ae9765
 ---> <b>cca054892aec</b>
</code></pre>

<ul>
<li>a container is run</li>
<li>changes corresponding to the instruction defined in the step are done inside of this container</li>
<li>the container is committed into an image (that is an <strong>intermediate</strong> image) that will be used as the base image of the next step</li>
</ul>
<p>Now the last step.. let's change our build starting from the previous Dockerfile and changing it: </p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:18.04</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>figlet
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;figlet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;script&quot;</span><span class="p">]</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ciccio&quot;</span><span class="p">]</span><span class="w">  </span>&lt;----
</code></pre></div>
<p>build it as we did before: </p>
<pre><code>
<b>docker build -t testnone .</b>
Sending build context to Docker daemon  2.048kB
Step 1/5 : FROM ubuntu:18.04
 ---> 81bcf752ac3d
Step 2/5 : RUN apt-get update
 ---> Using cache
 ---> e095319ffe18
Step 3/5 : RUN apt-get install figlet
 ---> Using cache
 ---> 9ad1cce70073
Step 4/5 : ENTRYPOINT ["figlet", "-f", "script"]
 ---> Using cache
 ---> cca054892aec
Step 5/5 : CMD ["Ciccio"]
 ---> Running in 976759d6217c
Removing intermediate container 976759d6217c
 ---> 3624cff02928
Successfully built <b>3624cff02928</b>
Successfully tagged testnone:latest
</code></pre>

<p>and now check again your images.. </p>
<pre><code>
<b>docker images</b>

REPOSITORY                    TAG       IMAGE ID       CREATED          SIZE
testnone                      latest    <b>3624cff02928</b>   4 seconds ago    101MB
&ltnone&gt                        &ltnone&gt    f0684153d22f   17 minutes ago   101MB
ubuntu                        18.04     81bcf752ac3d   3 weeks ago      63.1MB
gcr.io/k8s-minikube/kicbase   v0.0.22   bcd131522525   5 weeks ago      1.09GB
ubuntu                        latest    7e0aa2d69a15   7 weeks ago      72.7MB
</code></pre>

<p>Now, this IMAGE ID <strong>f0684153d22f</strong> is not more linked to the image named <code>testnone</code>  cause the second build has set it on the newly created image (the one containing the changes we did in Dockerfile)</p>
<p>The previous image, now considered as dangling, is not referenced anymore. We can remove it, but we probably first need to make sure we have not used the same tag in the second build by mistake (that happens :) )</p>
<p>If needed, you can tag again the dandling image any other image ( we saw it previously ) </p>
<p>Finally, in order to check ( and possibly remove ) the dangling images you can play with something like this: </p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>docker<span class="w"> </span>images<span class="w"> </span>-a<span class="w"> </span>--filter<span class="o">=</span><span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 INFN
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "toc.integrate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>